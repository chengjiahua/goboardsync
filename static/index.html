<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>Go-Weiqi Bridge 控制台</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
</head>
<body class="bg-gray-100 p-8">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        function App() {
            const [status, setStatus] = useState("未连接");
            const [lastMove, setLastMove] = useState(null);
            const [ws, setWs] = useState(null);

            useEffect(() => {
                const socket = new WebSocket("ws://localhost:8080/ws");
                socket.onopen = () => setStatus("已连接");
                socket.onclose = () => setStatus("断开连接");
                socket.onmessage = (e) => {
                    if (e.data.startsWith("move:")) {
                        setLastMove(e.data.replace("move:", ""));
                    }
                };
                setWs(socket);
                return () => socket.close();
            }, []);

            return (
                <div class="max-w-md mx-auto bg-white rounded-xl shadow-md overflow-hidden md:max-w-2xl p-6">
                    <h1 class="text-2xl font-bold mb-4">围棋联动控制台</h1>
                    <div class="mb-4">
                        <span class="font-semibold">状态: </span>
                        <span class={status === "已连接" ? "text-green-500" : "text-red-500"}>{status}</span>
                    </div>
                    <div class="p-4 bg-gray-50 rounded border">
                        <h2 class="font-bold mb-2">最新落子:</h2>
                        <div class="text-4xl text-center py-4 font-mono text-blue-600">
                            {lastMove || "--"}
                        </div>
                    </div>
                    <div class="mt-6 space-y-2">
                        <p class="text-sm text-gray-500 italic">
                            提示：请确保“腾讯围棋”和“KaTrain”已打开，并在“腾讯围棋”中开启显示手数。
                        </p>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
