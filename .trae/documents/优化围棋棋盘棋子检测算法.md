## 围棋棋盘棋子检测算法优化计划

### 1. 问题分析
- **识别率为0**：所有测试都失败，检测到的坐标与预期坐标相差很大
- **角标检测不稳定**：很多图片使用BGR检测，HSV检测失败，检测到的角标位置集中在边缘
- **坐标映射错误**：映射后的坐标很多是固定位置，如(x: 2, y: 8)、(x: 19, y: 19)等
- **棋盘定位失败**：所有图片都使用fallback方案，自动棋盘定位失败
- **缺少误差统计**：没有坐标平方差等误差统计指标来量化改进效果

### 2. 关键信息
- **角标形状**：等边直角三角形，位于棋子左上角
- **白棋角标颜色**：RGB(28, 34, 241)（蓝色）
- **黑棋角标颜色**：RGB(234, 61, 53)（红色）

### 3. 优化方案

#### 3.1 改进角标检测算法
- **使用精确的RGB颜色值**：根据用户提供的具体RGB颜色值，调整颜色分割阈值
- **增强形状检测**：添加三角形形状检测，确保检测到的是角标而不是其他干扰
- **添加几何约束**：确保角标位置符合棋子左上角的几何约束
- **多尺度检测**：实现多尺度角标检测，提高检测稳定性

#### 3.2 优化坐标映射算法
- **改进网格计算**：优化CalculateGrid函数，提高19×19交叉点网格的准确性
- **增强坐标映射**：改进MapToGrid函数，提高坐标映射精度
- **添加误差校正**：基于历史数据和几何约束添加误差校正机制

#### 3.3 改进棋盘定位算法
- **优化边缘检测**：调整Canny边缘检测参数，提高边缘检测效果
- **增强直线检测**：改进HoughLinesP参数，提高直线检测准确率
- **添加棋盘验证**：增加棋盘区域验证机制，确保定位的棋盘区域正确
- **优化fallback方案**：调整硬编码的棋盘区域坐标，提高fallback方案的准确性

#### 3.4 添加误差统计功能
- **计算坐标平方差**：添加坐标平方差计算，量化检测误差
- **统计误差分布**：分析误差分布，识别主要误差来源
- **生成误差报告**：为每个测试用例生成详细的误差报告

#### 3.5 循环优化策略
- **迭代优化**：根据误差统计结果，有针对性地优化算法参数
- **批量测试**：使用批量测试验证优化效果
- **持续改进**：循环执行"测试→分析→优化→测试"的流程

### 4. 实施步骤
1. **第一步**：使用用户提供的具体RGB颜色值优化角标检测算法
2. **第二步**：改进坐标映射算法，提高坐标映射精度
3. **第三步**：优化棋盘定位算法，减少对fallback的依赖
4. **第四步**：添加误差统计功能，量化检测误差
5. **第五步**：循环优化，直到检测准确率显著提高

### 5. 预期目标
- **短期目标**：提高检测准确率，减少坐标误差
- **中期目标**：实现稳定的角标检测和坐标映射
- **长期目标**：达到90%以上的检测准确率，满足实际应用需求