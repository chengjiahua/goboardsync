# 提升围棋最后一手坐标识别率改进计划

## 现状分析
- 当前识别率：43%
- 现有方案：已实现 OCR 手数获取和颜色判断（单数黑棋，双数白棋）
- 核心问题：最后一手棋子的落点识别不够准确

## 改进方向

### 1. 棋盘校准优化
- **问题**：自动校准可能存在偏差，导致网格坐标不准确
- **改进**：
  - 优化 `AutoCalibrateBoard` 函数中的参数
  - 增加网格验证步骤，确保 19x19 网格的准确性
  - 改进线条聚类和补全算法

### 2. 棋子颜色分析优化
- **问题**：颜色阈值可能不够优化，导致误判
- **改进**：
  - 调整 `AnalyzeStoneColor` 函数中的亮度和颜色范围阈值
  - 增加颜色分析的鲁棒性，适应不同光线条件
  - 实现动态阈值调整

### 3. 最新落点识别优化
- **问题**：复杂度计算和标记检测不够准确
- **改进**：
  - 优化 `CalculateCenterComplexity` 函数中的标记检测逻辑
  - 增加多种标记模式的支持（不同围棋软件的标记方式）
  - 改进候选落点的排序和选择算法
  - 增加空间关系分析，考虑棋子的相邻关系

### 4. OCR 集成优化
- **问题**：OCR 失败时的回退逻辑可能不够完善
- **改进**：
  - 增强 OCR 结果的解析能力
  - 优化 OCR 失败时的回退策略
  - 增加手数和颜色的一致性验证

### 5. 状态管理优化
- **问题**：上次识别状态的更新和使用可能存在问题
- **改进**：
  - 优化状态更新逻辑，确保状态的准确性
  - 增加状态验证步骤
  - 实现更智能的状态比较算法

## 实施步骤

1. **第一步**：运行当前测试，记录基准识别率
2. **第二步**：优化棋盘校准算法
3. **第三步**：改进棋子颜色分析
4. **第四步**：增强最新落点识别
5. **第五步**：优化 OCR 集成
6. **第六步**：改进状态管理
7. **第七步**：运行测试，评估改进效果
8. **第八步**：如果识别率提升超过 10%，提交代码
9. **第九步**：循环往复，持续优化

## 预期目标
- 识别率提升至少 10%
- 保持代码的可读性和可维护性
- 确保算法的鲁棒性和适应性